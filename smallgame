import sys
sys.path.insert(0, '../')

from vk_api.longpoll import VkLongPoll, VkEventType
from vk_api.keyboard import VkKeyboard, VkKeyboardColor
from vk_api.bot_longpoll import VkBotLongPoll, VkBotEventType
import vk_api
from datetime import datetime
import time
from vk_api import VkUpload
import wikipedia
import requests
from vk_api.utils import get_random_id
import random
import json
import bs4 as bs4
import sqlite3 as sql
import vkcoin

#login, password='login','password'
# vk_session = vk_api.VkApi(login, password)
# vk_session.auth()
token =''
vk_session = vk_api.VkApi(token=token)
session_api = vk_session.get_api()
wikipedia.set_lang("RU")
session = requests.Session()
longpoll = VkLongPoll(vk_session)


merchant = vkcoin.VKCoinApi(user_id=320547639, key='')

merchant.set_shop_name(name='BotKeril')

result = merchant.get_payment_url(amount=1000000, payload=100000234, free_amount=False)
print(result)


connection = sql.connect("users.sqlite", check_same_thread=False)



q = connection.cursor()






connection.commit()
connection.close()
list = ['1.jpg','2.jpg','3.jpg']

photo = random.choice(list)






@merchant.lp_handler
def payment_received(data):
    """
    –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞ –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω–∞ —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è. –û–Ω–∞ –º–æ–∂–µ—Ç –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è –∫–∞–∫ —É–≥–æ–¥–Ω–æ
    :param data.to_id: –í–∞—à ID –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
    :param data.id: ID –ø–ª–∞—Ç–µ–∂–∞
    :param data.created_at: Unix timestamp, –≤—Ä–µ–º—è –∫–æ–≥–¥–∞ –±—ã–ª —Å–æ–≤–µ—Ä—à—ë–Ω –ø–ª–∞—Ç—ë–∂
    :param data.from_id: ID –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –ø–ª–∞—Ç–µ–∂–∞
    :param data.amount: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö VK Coin
    """

    user_id = data.to_id
    amount = data.amount

    print('–ü–æ–ª—É—á–µ–Ω –ø–ª–∞—Ç—ë–∂ –Ω–∞ —Å—É–º–º—É {amount} –æ—Ç {user_id}'.format(amount=amount, user_id=user_id))
    # –í–º–µ—Å—Ç–æ print –≤—ã –º–æ–∂–µ—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è







rand1 = random.randint(1, 50)
upload = VkUpload(vk_session)  # –î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
time.sleep(1)
print("------------------")
print("| Server started |")
print("------------------")
def create_keyboard(response):
    keyboard = VkKeyboard(one_time=True)

    if response == '!–º–µ–Ω—é':

        keyboard.add_button('üí¨ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫–æ–∏–Ω—ã', color=VkKeyboardColor.POSITIVE)
        keyboard.add_button('üñº –†–∞–Ω–¥–æ–º–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞', color=VkKeyboardColor.POSITIVE)



        keyboard.add_line()  # –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≤—Ç–æ—Ä—É—é —Å—Ç—Ä–æ–∫—É
        keyboard.add_button('üì∞ –í–∏–∫–∏–ø–µ–¥–∏—è', color=VkKeyboardColor.NEGATIVE)
        keyboard.add_button('üé∞ –†–∞–Ω–¥–æ–º–∞–π–∑–µ—Ä', color=VkKeyboardColor.NEGATIVE)


        keyboard.add_line()
        keyboard.add_button('–ó–∞–∫—Ä—ã—Ç—å', color=VkKeyboardColor.DEFAULT)




    elif response == '–ø—Ä–∏–≤–µ—Ç':
        keyboard.add_button('–¢–µ—Å—Ç', color=VkKeyboardColor.POSITIVE)

    elif response == '–Ω–∞—Å—Ç—Ä–æ–π–∫–∏':
        keyboard.add_button('–Ø–∑—ã–∫', color=VkKeyboardColor.NEGATIVE)
        keyboard.add_button('–¶–≤–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞', color=VkKeyboardColor.POSITIVE)
        keyboard.add_line()
        keyboard.add_button('–ó–∞–∫—Ä—ã—Ç—å', color=VkKeyboardColor.DEFAULT)



    elif response == '–∑–∞–∫—Ä—ã—Ç—å':
        print('–∑–∞–∫—Ä—ã–≤–∞–µ–º –∫–ª–∞–≤—É')
        return keyboard.get_empty_keyboard()

    keyboard = keyboard.get_keyboard()
    return keyboard


def send_message(vk_session, id_type, id, message=None, attachment=None, keyboard=None):
    vk_session.method('messages.send',{id_type: id, 'message': message, 'random_id': random.randint(-2147483648, +2147483648), "attachment": attachment, 'keyboard': keyboard})


def photo(user_id):
    a = vk_session.method("photos.getMessagesUploadServer")
    b = requests.post(a['upload_url'], files={'photo': open('2.jpg', 'rb')}).json()
    c = vk_session.method('photos.saveMessagesPhoto', {'photo': b['photo'], 'server': b['server'], 'hash': b['hash']})[0]
    send_message(vk_session, 'user_id', event.user_id, message=' ' , attachment= f'photo{c["owner_id"]}_{c["id"]}')


while True:
    for event in longpoll.listen():
        if event.type == VkEventType.MESSAGE_NEW:
            print("-------------------------------")
            print('| –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏—à–ª–æ –≤: ' + str(datetime.strftime(datetime.now(), "%H:%M:%S")) + " |")
            print('| –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è: ' + str(event.text) + " /")
            print(event.user_id)
            print("-------------------------------")
            response = event.text.lower()
            keyboard = create_keyboard(response)
            upload = vk_api.VkUpload(vk_session)

            usernameid = event.user_id

            if event.from_user and not event.from_me:

                if event.text == 'üì∞ –í–∏–∫–∏–ø–µ–¥–∏—è':
                    send_message(vk_session, 'user_id', event.user_id, message='–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä —Å—Ç–∞—Ç—å–∏: \n !–î–ª–∏–Ω–Ω–∞—è —Å—Ç–∞—Ç—å—è \n !–°—Ä–µ–¥–Ω—è—è —Å—Ç–∞—Ç—å—è \n !–ö–æ—Ä–æ—Ç–∫–∞—è —Å—Ç–∞—Ç—å—è')

                if event.text == 'üé∞ –†–∞–Ω–¥–æ–º–∞–π–∑–µ—Ä':
                    send_message(vk_session, 'user_id', event.user_id, message='–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–Ω–∞—á–µ–Ω–∏–π: \n  !–¥–≤–∞ \n !—Ç—Ä–∏')

                if event.text == 'üñº –†–∞–Ω–¥–æ–º–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞':
                    send_message(vk_session, 'user_id', event.user_id,message='KaVo??')
                    photo(id)

                if event.text == 'üí¨ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫–æ–∏–Ω—ã':
                    send_message(vk_session, 'user_id', event.user_id, message='–í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ 1000 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–æ–∏–Ω–æ–≤!')
                    result = merchant.send_coins(event.user_id, 10000)








                if event.text == '!–¥–ª–∏–Ω–Ω–∞—è —Å—Ç–∞—Ç—å—è' or event.text == '!–î–ª–∏–Ω–Ω–∞—è —Å—Ç–∞—Ç—å—è':
                    if event.from_user:  # –ï—Å–ª–∏ –Ω–∞–ø–∏—Å–∞–ª–∏ –≤ KC
                        send_message(vk_session, 'user_id', event.user_id,
                                     message='–í–≤–æ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é, –Ω–∞–ø—Ä–∏–º–µ—Ä: apple food –∏–ª–∏ apple company \n –ë–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫–∏'  # –ü–∏—à–µ–º "–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å"
                                     )
                        time.sleep(1.5)
                        send_message(vk_session, 'user_id', event.user_id,
                            message='–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å..'  # –ü–∏—à–µ–º "–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å"
                        )
                    for event in longpoll.listen():
                        if event.type == VkEventType.MESSAGE_NEW and event.to_me and event.text:  # –ü–∏–Ω–∞–µ–º longpoll
                            if event.from_user:
                                send_message(vk_session, 'user_id', event.user_id,
                                    message='–í–æ—Ç —á—Ç–æ —è –Ω–∞—à—ë–ª: \n' + str(wikipedia.summary(event.text, sentences=9))
                                    # –ü–∏—à–µ–º "–í–æ—Ç —á—Ç–æ —è –Ω–∞—à—ë–ª" –ò —Ç–æ —á—Ç–æ –≤–µ—Ä–Ω—ë—Ç –Ω–∞–º api Wikipedia –ø–æ –∑–∞–ø—Ä–æ—Å—É —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
                                )
                                break
                        continue





                if event.text == '!—Å—Ä–µ–¥–Ω—è—è —Å—Ç–∞—Ç—å—è' or event.text == '!–°—Ä–µ–¥–Ω—è—è —Å—Ç–∞—Ç—å—è':
                    if event.from_user:  # –ï—Å–ª–∏ –Ω–∞–ø–∏—Å–∞–ª–∏ –≤ KC
                        send_message(vk_session, 'user_id', event.user_id,
                                     message='–í–≤–æ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é, –Ω–∞–ø—Ä–∏–º–µ—Ä: apple food –∏–ª–∏ apple company \n –ë–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫–∏'  # –ü–∏—à–µ–º "–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å"
                                     )
                        time.sleep(1.5)
                        send_message(vk_session, 'user_id', event.user_id,
                            message='–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å..'  # –ü–∏—à–µ–º "–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å"
                        )
                    for event in longpoll.listen():
                        if event.type == VkEventType.MESSAGE_NEW and event.to_me and event.text:  # –ü–∏–Ω–∞–µ–º longpoll
                            if event.from_user:
                                send_message(vk_session, 'user_id', event.user_id,
                                    message='–í–æ—Ç —á—Ç–æ —è –Ω–∞—à—ë–ª: \n' + str(wikipedia.summary(event.text, sentences=6))
                                    # –ü–∏—à–µ–º "–í–æ—Ç —á—Ç–æ —è –Ω–∞—à—ë–ª" –ò —Ç–æ —á—Ç–æ –≤–µ—Ä–Ω—ë—Ç –Ω–∞–º api Wikipedia –ø–æ –∑–∞–ø—Ä–æ—Å—É —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
                                )
                                break
                        continue

                if event.text == '!–∫–æ—Ä–æ—Ç–∫–∞—è —Å—Ç–∞—Ç—å—è' or event.text == '!–ö–æ—Ä–æ—Ç–∫–∞—è —Å—Ç–∞—Ç—å—è':
                    if event.from_user:  # –ï—Å–ª–∏ –Ω–∞–ø–∏—Å–∞–ª–∏ –≤ KC
                        send_message(vk_session, 'user_id', event.user_id,
                                     message='–í–≤–æ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é, –Ω–∞–ø—Ä–∏–º–µ—Ä: apple food –∏–ª–∏ apple company \n –ë–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫–∏'  # –ü–∏—à–µ–º "–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å"
                                     )
                        time.sleep(1.5)
                        send_message(vk_session, 'user_id', event.user_id,
                            message='–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å..'  # –ü–∏—à–µ–º "–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å"
                        )
                    for event in longpoll.listen():
                        if event.type == VkEventType.MESSAGE_NEW and event.to_me and event.text:  # –ü–∏–Ω–∞–µ–º longpoll
                            if event.from_user:
                                send_message(vk_session, 'user_id', event.user_id,
                                    message='–í–æ—Ç —á—Ç–æ —è –Ω–∞—à—ë–ª: \n' + str(wikipedia.summary(event.text, sentences=3))
                                    # –ü–∏—à–µ–º "–í–æ—Ç —á—Ç–æ —è –Ω–∞—à—ë–ª" –ò —Ç–æ —á—Ç–æ –≤–µ—Ä–Ω—ë—Ç –Ω–∞–º api Wikipedia –ø–æ –∑–∞–ø—Ä–æ—Å—É —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
                                )
                                break
                        continue

                elif response == "–ø—Ä–∏–≤–µ—Ç":
                    send_message(vk_session, 'user_id', event.user_id, message='–ü—Ä–∏–≤–µ—Ç, \n –≤–≤–µ–¥–∏ "!–∫–æ–º–∞–Ω–¥—ã" —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥')


                elif response == "!–º–µ–Ω—é":
                    send_message(vk_session, 'user_id', event.user_id, message='–ü–æ–∂–∞–ª—É–π—Å—Ç–∞', keyboard=keyboard)

                elif response == '!–∫–æ–º–∞–Ω–¥—ã':
                    send_message(vk_session, 'user_id', event.user_id, message='–°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞: \n \n üî∏ !–ú–µ–Ω—é \n üîπ !–í—Ä–µ–º—è \n üî∏ !–î–∞—Ç–∞ \n üîπ !–ò–Ω—Ñ–∞ \n üî∏ !–ü–æ–º–æ—â—å')

                elif response == '–∑–∞–∫—Ä—ã—Ç—å':
                    send_message(vk_session, 'user_id', event.user_id, message='–•–æ—Ä–æ—à–æ', keyboard=keyboard)

                elif response == '–Ω–∞—Å—Ç—Ä–æ–π–∫–∏':
                    send_message(vk_session, 'user_id', event.user_id, message='–§—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–ª–æ—Ö–æ.', keyboard=keyboard)

                elif response == '–ù–∞—á–∞—Ç—å':
                    send_message(vk_session, 'user_id', event.user_id,
                                 message='–ü—Ä–∏–≤–µ—Ç, \n –≤–≤–µ–¥–∏ "!–∫–æ–º–∞–Ω–¥—ã" —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥')

                elif response == '–Ω–∞—á–∞—Ç—å':
                    send_message(vk_session, 'user_id', event.user_id, message='–ü—Ä–∏–≤–µ—Ç \n –≤–≤–µ–¥–∏ "!–∫–æ–º–∞–Ω–¥—ã" —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥')

                elif response == '!–≤—Ä–µ–º—è' or response == '!–í—Ä–µ–º—è':
                    send_message(vk_session, 'user_id', event.user_id, message='–°–µ–π—á–∞—Å ' + str(datetime.strftime(datetime.now(), "%H:%M:%S")))

                elif event.text == "!–¥–∞—Ç–∞" or event.text == "!–î–∞—Ç–∞":
                    send_message(vk_session, 'user_id', event.user_id, message='–°–µ–≥–æ–¥–Ω—è ' + str(datetime.strftime(datetime.now(), "%x")))

                elif response == '!–∏–Ω—Ñ–∞' or response == '!–ò–Ω—Ñ–∞':
                    send_message(vk_session, 'user_id', event.user_id,
                                 message='–°–µ–π—á–∞—Å –ø—Ä–æ—Ö–æ–¥–∏—Ç –Ω–∞–±–æ—Ä –º–æ–¥–µ—Ä–∞—Ü–∏–∏. \n -------------------------------\n| –ë–æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω '
                                        '- \n| vk.com/kirysshaloveyou \n| github.com/0susboy0 \n -------------------------------\n –í–µ—Ä—Å–∏—è –±–æ—Ç–∞ - 0.4')

                elif response == '!–ø–æ–º–æ—â—å' or response == '!–ü–æ–º–æ—â—å':
                    send_message(vk_session, 'user_id', event.user_id, message='–ü—Ä–∏–≤–µ—Ç –µ—â–µ —Ä–∞–∑. \n –ù–∞—à –±–æ—Ç —É–º–µ–µ—Ç —Å–∏–Ω—Ç–µ–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è, '
                    '–æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–ª—É—á–∞–π–Ω—ã–µ –º–µ–º–∞—Å—ã, \n –ï—â–µ —Ç—ã –º–æ–∂–µ—â—å –∏—Å–∫–∞—Ç—å –ª—é–±—ã–µ —Å—Ç–∞—Ç—å–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ "–í–∏–∫–∏–ø–µ–¥–∏—è" \n –ß—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –≤–≤–µ–¥–∏ "!–∫–æ–º–∞–Ω–¥—ã". ')



                elif response == "!—Å–ø–∞—Å–∏–±–æ" or response == "!–°–ø–∞—Å–∏–±–æ":
                    send_message(vk_session, 'user_id', event.user_id, message='–Ø –∫–æ–Ω–µ—á–Ω–æ –≤—Å–µ –ø–æ–Ω–∏–º–∞—é, \n –Ω–æ —Å–ø–∞—Å–∏–±–æ –≤ –ø–∞–∫–µ—Ç –Ω–µ –ø–æ–ª–æ–∂–∏—à—å \n –∏ –Ω–∞ —Ö–ª–µ–± –Ω–µ –Ω–∞–º–∞–∂–µ—à—å')






                if event.text == '!–¥–≤–∞' or event.text == '!–î–≤–∞':
                    if event.from_user:  # –ï—Å–ª–∏ –Ω–∞–ø–∏—Å–∞–ª–∏ –≤ KC
                        send_message(vk_session, 'user_id', event.user_id,
                                     message='–í–≤–µ–¥–∏—Ç–µ –ø–µ—Ä–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:'  # –ü–∏—à–µ–º "–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å"
                                     )
                        time.sleep(5)
                        send_message(vk_session, 'user_id', event.user_id,
                            message='–í–≤–µ–¥–∏—Ç–µ –≤—Ç–æ—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:'  # –ü–∏—à–µ–º "–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å"
                        )
                    reson = random.choice(response, )
                    for event in longpoll.listen():
                        if event.type == VkEventType.MESSAGE_NEW and event.to_me and event.text:  # –ü–∏–Ω–∞–µ–º longpoll
                            if event.from_user:
                                send_message(vk_session, 'user_id', event.user_id,
                                    message='–Ø –¥—É–º–∞—é —ç—Ç–æ - ' + reson)
                                    # –ü–∏—à–µ–º "–í–æ—Ç —á—Ç–æ —è –Ω–∞—à—ë–ª" –ò —Ç–æ —á—Ç–æ –≤–µ—Ä–Ω—ë—Ç –Ω–∞–º api Wikipedia –ø–æ –∑–∞–ø—Ä–æ—Å—É —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

                                break
                        continue





merchant.longpoll_start()  # –ó–∞–ø—É—Å–∫–∞–µ–º LongPoll

